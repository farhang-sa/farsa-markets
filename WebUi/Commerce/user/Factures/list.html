<?php defined( 'Fallon_Root' ) or die( 'Access Denied : ' . basename( __FILE__ ) ) ;
if ( ! $App->User( "login" ) ) 
	return $Html->NotLogedinAlert();
$Payments = $App->SilentCall( "Commerce" , "User" , "Factures" , "list" ); 
$PayState = $App->input->pay_state ;
$PaySearch = $App->input->pay_search ; ?>
<div class="col-xs-12 factures-list <?php $Html->EchoDir();?>">

	<div class="col-xs-12 padding5">

		<div class="col-xs-12 alert alert-info padding5">

			<h3 style="padding:10px;margin:5px;">

			<?php $Html->pTranslate( "My Orders" ); ?>

			</h3>

		</div>

	</div>

	<form class="col-xs-12 padding5" method="post">

		<div class="col-xs-12 col-sm-4 padding5 <?php $Html->EchoDir(); ?>">

			<select name="pay_state" class="form-control input-lg">
				<option value="">
					<?php $Html->pTranslate( "All" ); ?>
				</option>
				<?php $lst = array( "Saved" , "Preparing" , "Sent" , 
					"Canceled" , "Received" , "Returned" , "Resent" , "Finished" );  
				foreach ( $lst as $state ) : ?>
				<option value="<?php print $state; ?>" 
					<?php if( $PayState == $state ) print "selected";?>>
					<?php $Html->pTranslate( $state ); ?>
				</option>
				<?php endforeach; ?>
			</select>

		</div>

		<div class="col-xs-12 col-sm-6 padding5 <?php $Html->EchoDir(); ?>">

			<input type="text" name="pay_search" class="input input-lg form-control"
				placeholder="<?php $Html->pTranslate( 'Keywords' ); ?>" 
				value="<?php if( $PaySearch ) print $PaySearch; ?>" />

		</div>

		<div class="col-xs-12 col-sm-2 padding5">

			<input type="submit" class="btn btn-success"
				value="<?php $Html->pTranslate( 'Search' ); ?>" />
		
		</div>

	</form>

	<div class="col-xs-12 padding5">
	<?php if ( ! $Payments ) :
		$Html->NotFoundedAlert( 'You Have No Factures' , 'danger');
	else :
		if ( isset( $Payments["code"] ) ) 
			$Payments = array( $Payments );
		foreach( $Payments as $facture ) : ?>
		<div class="col-xs-12 facture-holder padding0">
			<?php $Html->Call( "Commerce" , "Managers" , "Factures" , 
				"View" , [ "Facture" => $facture , "self_view" => 1 ] ); ?>
		</div>
		<div class='col-xs-12 padding2'>&#160;</div>
	<?php endforeach; endif; ?>
	</div>
	<?php if( $Payments && count( $Payments ) == 100 ) : ?>
	<div class="col-xs-12 padding10">
		<?php // Setup Page Routings ?>
	</div>
	<?php endif; ?>

</div>